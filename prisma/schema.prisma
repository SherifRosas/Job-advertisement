// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String    @id @default(cuid())
  email             String    @unique
  emailVerified     Boolean   @default(false)
  phoneNumber       String?
  phoneVerified     Boolean   @default(false)
  gmailId           String?   @unique
  name              String?
  address           String?
  nationalIdFront   String?
  nationalIdBack    String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  applications      Application[]
  messages          Message[]

  @@map("users")
}

model Application {
  id                    String      @id @default(cuid())
  userId               String
  fullName             String
  address              String
  phoneNumber          String
  nationalIdFront     String
  nationalIdBack      String
  requirementsAgreed   Boolean      @default(false)
  documentsAgreed      Boolean      @default(false)
  aiVerified           Boolean      @default(false)
  aiVerificationNotes  String?
  paymentStatus        String       @default("pending") // pending, paid, failed
  paymentAmount        Float        @default(1000.0)
  paymentTransactionId String?
  selectionStatus      String       @default("pending") // pending, selected, rejected
  selectedAt           DateTime?
  selectedBy           String?
  selectionEmailSent   Boolean      @default(false)
  selectionEmailSentAt DateTime?
  createdAt            DateTime     @default(now())
  updatedAt            DateTime     @updatedAt

  user                 User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  coupon               Coupon?
  appointment          Appointment?
  messages             Message[]
  revenue              Revenue?

  @@map("applications")
}

model Coupon {
  id            String      @id @default(cuid())
  applicationId String      @unique
  couponCode    String      @unique
  securityMark  String
  downloadable  Boolean     @default(true)
  printable     Boolean     @default(true)
  createdAt     DateTime    @default(now())

  application   Application  @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@map("coupons")
}

model Appointment {
  id                      String      @id @default(cuid())
  applicationId           String      @unique
  applicantName           String
  socialSecurityCardDetails String?
  securityMark            String
  date                    DateTime
  time                    String
  location                String
  createdAt               DateTime    @default(now())

  application             Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@map("appointments")
}

model Message {
  id            String      @id @default(cuid())
  userId        String?
  applicationId String?
  type          String      // payment_reminder, interview_reminder, selection_notification
  sentAt        DateTime?
  status        String      @default("pending") // pending, sent, failed
  content       String?
  createdAt     DateTime    @default(now())

  user          User?       @relation(fields: [userId], references: [id], onDelete: Cascade)
  application   Application? @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@map("messages")
}

model Settings {
  id                    String    @id @default(cuid())
  bankAccountNumber     String?
  bankName              String?
  bankDetails           String?
  advertisementStartDate DateTime?
  selectionDeadline     DateTime?
  interviewLocation     String?
  advertisementStatus   String    @default("active") // active, closed
  closedAt              DateTime?
  closedBy              String?
  reactivationQrCode    String?
  qrCodeExpiresAt       DateTime?
  qrCodeUsed            Boolean   @default(false)
  adminGmail            String?   @default("sherifrosas.ai@gmail.com")
  canReactivate         Boolean   @default(true)
  createdAt             DateTime  @default(now())
  updatedAt              DateTime  @updatedAt

  @@map("settings")
}

model Revenue {
  id            String      @id @default(cuid())
  applicationId String      @unique
  amount        Float
  paymentDate   DateTime    @default(now())
  status        String      @default("completed") // completed, refunded
  createdAt     DateTime    @default(now())

  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@map("revenue")
}


